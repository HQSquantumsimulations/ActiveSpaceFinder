

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorials &mdash; ASF 0.19 pre-alpha documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Code documentation" href="../modules.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html" class="icon icon-home"> ASF
          

          
            
            <img src="../_static/HQS.jpg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.19 pre-alpha
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Code documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics-the-active-space-of-fe-oh-2-4">1. Basics: The active space of <span class="math notranslate nohighlight">\(Fe(OH_2)_4\)</span></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-wrapper-function-predefined-strategy">1.1 The wrapper function (predefined strategy)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#avas-as-initial-guess">1.2 AVAS as initial guess</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-calculation-of-vertical-excitation-energies">2. Advanced: Calculation of vertical excitation energies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#utility-functions">3. Utility functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-the-mos-with-jmol">3.1 Visualizing the MOs with jmol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plot-selection-thresholds-c-2">3. Plot selection thresholds <span class="math notranslate nohighlight">\(C_2\)</span></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calculation-of-natural-orbitals">4. Calculation of natural orbitals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unrestricted-natural-orbitals">4.1 Unrestricted natural orbitals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wrapper-function">4.2 Wrapper function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manual-functions">4.3 Manual functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ASF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Tutorials</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorials">
<h1>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basics-the-active-space-of-fe-oh-2-4">
<h2>1. Basics: The active space of <span class="math notranslate nohighlight">\(Fe(OH_2)_4\)</span><a class="headerlink" href="#basics-the-active-space-of-fe-oh-2-4" title="Permalink to this headline">¶</a></h2>
<p>In this section we will mainly focus on how to use the ASF in order to find
a reasonable active space for <span class="math notranslate nohighlight">\(Fe(OH_2)_4\)</span>groundstate.
The first examples is using the wrapper function. The second example uses AVAS
instead of natural orbitals for an initial guess. The last example follows
a more advanced symmetric calculation of several <span class="math notranslate nohighlight">\(Fe(OH_2)_4\)</span>excitation energies.</p>
<div class="section" id="the-wrapper-function-predefined-strategy">
<h3>1.1 The wrapper function (predefined strategy)<a class="headerlink" href="#the-wrapper-function-predefined-strategy" title="Permalink to this headline">¶</a></h3>
<p>Providing a converged SCF object you can simply call the wrapper function to provide you with an active space.
An example script for this case can be found under <code class="docutils literal notranslate"><span class="pre">/examples/simple/fe.py</span></code>.</p>
<p>At the beginning of the script we set the coordinates spin and charge of the system.
The <span class="math notranslate nohighlight">\(Fe(OH_2)_4\)</span>molecule is then set up as a PySCF <code class="docutils literal notranslate"><span class="pre">Mole</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="kn">import</span> <span class="nn">asf</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Fe -0.0000000 0.0000000 0.0000000</span>
<span class="s2">O 0.0000000 2.0622910 0.0000000</span>
<span class="s2">H 0.7919274 2.6471973 0.0000000</span>
<span class="s2">H -0.7919274 2.6471973 0.0000000</span>
<span class="s2">O -0.0000000 0.0000000 2.0622910</span>
<span class="s2">H -0.0000000 0.7919274 2.6471973</span>
<span class="s2">H 0.0000000 -0.7919274 2.6471973</span>
<span class="s2">O 2.0622910 -0.0000000 -0.0000000</span>
<span class="s2">H 2.6471973 -0.0000000 0.7919274</span>
<span class="s2">H 2.6471973 -0.0000000 -0.7919274</span>
<span class="s2">O -0.0000000 -2.0622910 0.0000000</span>
<span class="s2">H -0.7919274 -2.6471973 -0.0000000</span>
<span class="s2">H 0.7919274 -2.6471973 -0.0000000</span>
<span class="s2">O 0.0000000 0.0000000 -2.0622910</span>
<span class="s2">H 0.0000000 -0.7919274 -2.6471973</span>
<span class="s2">H -0.0000000 0.7919274 -2.6471973</span>
<span class="s2">O -2.0622910 0.0000000 0.0000000</span>
<span class="s2">H -2.6471973 0.0000000 -0.7919274</span>
<span class="s2">H -2.6471973 0.0000000 0.7919274</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;minao&#39;</span><span class="p">}</span>
<span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># UHF for UNOs</span>
</pre></div>
</div>
<p>Then use Pyscf to converge the meanfield.
(*.chk, stores molecular orbital coefficients, etc.).
It is recommended to assure convergence of mean field before further calculations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">max_cycle</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">mo_new</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">stability</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">while</span> <span class="n">mo_new</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">:</span>
    <span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">dm0</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(</span><span class="n">mo_coeff</span><span class="o">=</span><span class="n">mo_new</span><span class="p">))</span>
</pre></div>
</div>
<p>The we simply input the mean field object into the <a class="reference internal" href="../modules.html#asf.asf.fas_no_guess" title="asf.asf.fas_no_guess"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.asf.fas_no_guess()</span></code></a> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Call the wrapper function.</span>
<span class="n">ASF</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">asf</span><span class="p">()</span>

<span class="n">ele</span><span class="p">,</span> <span class="n">mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">fas_no_guess</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">nat_type</span><span class="o">=</span><span class="s1">&#39;MP2&#39;</span><span class="p">,</span> <span class="n">machine_limit</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
<p>The function calculates the ‘MP2’ natural orbitals then selects an initial set of orbitals.
With the selected orbitals a large DMRGCI calculations is performed. The orbital
entropies are calculated from the DMRGCI results and the final active space is
chosen from the entropies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--------</span><span class="n">Wrapper</span> <span class="n">function</span><span class="o">--------</span>

<span class="o">---------------------</span>
<span class="n">Natural</span> <span class="n">orbital</span> <span class="n">selected</span> <span class="n">active</span> <span class="n">space</span>
<span class="n">orbitals</span><span class="p">:</span> <span class="mi">11</span> <span class="p">,</span> <span class="n">electrons</span><span class="p">:</span> <span class="mi">17</span>
<span class="o">---------------------</span>

<span class="o">-----------</span><span class="n">ASF</span><span class="o">-</span><span class="n">RUN</span><span class="o">----------</span>
<span class="n">Active</span> <span class="n">space</span><span class="p">:</span>  <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">]</span>
<span class="n">Active</span> <span class="n">electrons</span><span class="p">:</span>  <span class="mi">17</span>
<span class="n">Entropies</span> <span class="ow">in</span> <span class="n">memory</span> <span class="ow">or</span> <span class="n">entered</span> <span class="n">manually</span> <span class="n">now</span><span class="p">:</span>  <span class="kc">None</span>
<span class="n">Run</span> <span class="n">DMRG</span><span class="p">:</span>  <span class="kc">True</span>
<span class="n">symmetry</span><span class="p">:</span>
<span class="n">Spin</span><span class="p">,</span> <span class="n">Muliplicity</span><span class="p">:</span>  <span class="mi">3</span> <span class="p">,</span> <span class="mf">3.75</span>

<span class="n">DMRG</span> <span class="n">calculation</span> <span class="n">was</span> <span class="n">performed</span> <span class="n">on</span> <span class="mi">17</span> <span class="n">e</span><span class="o">-</span> <span class="ow">in</span> <span class="mi">11</span> <span class="n">MOs</span> <span class="p">(</span><span class="n">w</span><span class="o">/</span> <span class="kc">None</span> <span class="n">DMRG</span> <span class="n">M</span><span class="p">,</span> <span class="kc">None</span> <span class="n">DMRG</span> <span class="n">Sweeps</span><span class="p">,</span>  <span class="mi">251</span> <span class="n">DMRG_MaxM</span><span class="p">)</span>
<span class="n">Time</span> <span class="n">taken</span> <span class="k">for</span> <span class="n">DMRG</span> <span class="n">calculation</span><span class="p">:</span> <span class="mf">29.368440922000445</span> <span class="n">seconds</span>

<span class="n">Single</span> <span class="n">site</span> <span class="n">MO</span> <span class="n">entropies</span> <span class="ow">and</span> <span class="n">orbital</span> <span class="n">occupations</span><span class="p">:</span>
<span class="n">Starting</span> <span class="kn">from</span> <span class="mf">0.</span>
<span class="n">root</span> <span class="c1"># 0</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">33</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0147</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">2.0000</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">2.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">34</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0002</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.9981</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">2.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">35</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0083</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.9979</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">2.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">36</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0393</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.9978</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">2.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">37</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0086</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.9945</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">2.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">38</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0994</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.9824</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">2.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">39</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3694</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.9031</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">2.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">40</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5691</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.0168</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">1.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">41</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5210</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.0052</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">1.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">42</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.4998</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">1.0018</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">1.0000</span>
<span class="n">S</span><span class="p">[</span><span class="n">MO</span> <span class="mi">43</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3744</span><span class="p">,</span>  <span class="n">natural</span> <span class="n">occ</span> <span class="o">=</span> <span class="mf">0.1025</span><span class="p">,</span>  <span class="n">SCF</span> <span class="n">OCC</span> <span class="o">=</span> <span class="mf">0.0000</span>

<span class="n">ASF</span> <span class="n">suggested</span> <span class="n">active</span> <span class="n">space</span> <span class="k">for</span> <span class="n">root</span> <span class="c1">#0:</span>
<span class="n">Put</span> <span class="mi">5</span> <span class="n">e</span><span class="o">-</span> <span class="ow">in</span> <span class="n">these</span> <span class="mi">5</span> <span class="n">MOs</span><span class="p">:[</span><span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">]</span> <span class="k">with</span> <span class="n">TH</span><span class="p">:</span><span class="mf">0.19329214162255237</span>
</pre></div>
</div>
</div>
<div class="section" id="avas-as-initial-guess">
<h3>1.2 AVAS as initial guess<a class="headerlink" href="#avas-as-initial-guess" title="Permalink to this headline">¶</a></h3>
<p>Calculation using AVAS as initial guess is done similarly.
An example script for this case can be found under <code class="docutils literal notranslate"><span class="pre">examples/avas/c2.py</span></code>.
First we converge the meanfield object as mentioned before. Then,
we call AVAS to select an active space for us.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># AVAS initial guess.</span>
<span class="n">ao_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C 2s&#39;</span><span class="p">,</span> <span class="s1">&#39;C 2p&#39;</span><span class="p">]</span>
<span class="n">norb</span><span class="p">,</span> <span class="n">ne_act</span><span class="p">,</span> <span class="n">orbs</span> <span class="o">=</span> <span class="n">avas</span><span class="o">.</span><span class="n">avas</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ao_labels</span><span class="p">,</span> <span class="n">canonicalize</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>AVAS will provide an active space of selected atomic orbital labels.
You can view the molecular orbitals selected by AVAS using a utility function. This function
also creates a molden file which you can view using jmol or …</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot AVAS selected orbitals.</span>
<span class="c1"># orbital list</span>
<span class="n">fao</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">act_fao</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">ne_act</span><span class="p">)</span>
<span class="n">orblist</span> <span class="o">=</span> <span class="n">fao</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">norb</span><span class="p">)))</span>
<span class="n">asf</span><span class="o">.</span><span class="n">visualize_mos</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">orblist</span><span class="p">)</span>
</pre></div>
</div>
<p>This active space pre-selection is used for final active space selection via
ASFs <a class="reference internal" href="../modules.html#asf.asf.find_active_space" title="asf.asf.find_active_space"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.asf.find_active_space()</span></code></a> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select an active space using entropies.</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">find_active_space</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ne_act</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>After the final DMRG calculation finished, ASF prints the suggested active space:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.305753989276
RHF/RKS wavefunction has an internal instability
converged SCF energy = -75.3245002956272
RHF/RKS wavefunction is stable in the internal stability analysis
splash_image=jar:file:/usr/share/java/Jmol-14.6.4+2016.11.05.jar!/org/openscience/jmol/app/images/Jmol_splash.jpg
history file is /home/rshirazi/.jmol/history
user properties file is /home/rshirazi/.jmol/properties
(C) 2015 Jmol Development
Jmol Version: 14.6.4_2016.11.05  2016-11-10 03:30
java.vendor: Java: Ubuntu
java.version: Java 11.0.8
os.name: Linux
Access: ALL
memory: 21.7/130.0
processors available: 8
useCommandThread: false
User macros dir: /home/rshirazi/.jmol/macros
      exists: false
isDirectory: false
Executing script: script &quot;plot.spt&quot;;
-----------ASF-RUN----------
Active space:  8
Active electrons:  8
Entropies in memory or entered manually now:  None
Run DMRG:  True
symmetry:
Spin, Muliplicity:  0 , 0.0

CASCI E = -75.4734674486849  E(CI) = -18.1261155581167  S^2 = 0.0000000
DMRG calculation was performed on 8 e- in 8 MOs (w/ None DMRG M, None DMRG Sweeps,  251 DMRG_MaxM)
Time taken for DMRG calculation: 4.180823569011409 seconds

Single site MO entropies and orbital occupations:
Starting from 0.
root # 0
S[MO 2] = 0.9950,  natural occ = 1.9857,  SCF OCC = 2.0000
S[MO 3] = 0.3920,  natural occ = 1.8895,  SCF OCC = 2.0000
S[MO 4] = 1.1616,  natural occ = 1.8891,  SCF OCC = 2.0000
S[MO 5] = 0.9280,  natural occ = 1.3595,  SCF OCC = 2.0000
S[MO 6] = 0.0728,  natural occ = 0.6442,  SCF OCC = 0.0000
S[MO 7] = 1.1425,  natural occ = 0.1133,  SCF OCC = 0.0000
S[MO 8] = 0.4117,  natural occ = 0.1070,  SCF OCC = 0.0000
S[MO 9] = 0.3963,  natural occ = 0.0117,  SCF OCC = 0.0000

ASF suggested active space for root #0:
Put 8 e- in these 8 MOs:[2, 3, 4, 5, 6, 7, 8, 9] with TH:0.27069112074088336
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-calculation-of-vertical-excitation-energies">
<h2>2. Advanced: Calculation of vertical excitation energies<a class="headerlink" href="#advanced-calculation-of-vertical-excitation-energies" title="Permalink to this headline">¶</a></h2>
<p>In this section we will extend the application of the ASF towards a more practical example, namely
the calculation of the vertical excitation energy of <span class="math notranslate nohighlight">\(Fe(OH_2)_4\)</span>.
The code snippets for this example are located under <code class="docutils literal notranslate"><span class="pre">/examples/advanced/fe_sym.py</span></code>.</p>
<p>Also in this calculation we use the natural orbital occupation from MP2 for the pre-selection
of the active space. In this example, we won’t use the wrapper function.</p>
<p>After converging the meanfield as before, we Run MP2 calculations. To calculate the natural orbitals and their
occupation, you can use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.nat_orbs_obj()</span></code>, which returns the natural orbitals and their occupation.
You can plot the orbitals if you like by calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.visualize_mos()</span></code>, as mentioned before.
With the occupation numbers one can select an initial set of orbitals. Note that you can also select the orbitals by hand.
For this purpose you can use the <a class="reference internal" href="../modules.html#asf.asf.select_mos_occ" title="asf.asf.select_mos_occ"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.asf.select_mos_occ()</span></code></a>. For the details of threshold selection please look up
<a class="reference internal" href="../modules.html#asf.asf.calculate_criteria" title="asf.asf.calculate_criteria"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.asf.calculate_criteria()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mp2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">no</span><span class="p">,</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">nat_orbs_obj</span><span class="p">(</span><span class="n">mp2</span><span class="p">)</span>
<span class="n">sel_mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">select_mos_occ</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span> <span class="n">machine_limit</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we set up an empty list and calculate the active space using the initial selection of natural orbitals, for
each symmetry and spin state. Here we are interested in 3 degenerate quintet states and one sextet state.
Proper symmetry of these states can be calculated by looking up the orbital symmetries and product table.
Note that in PySCF and Block not all the symmetries are available. For instance in our case the point group of the
sextet aqua irion ion is Th, but PySCF uses the D2 symmetry.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">act_ele</span><span class="p">,</span> <span class="n">act_mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">find_active_space</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">asf</span><span class="o">.</span><span class="n">orbs_el_n</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">sel_mos</span><span class="p">),</span>
                                         <span class="n">sel_mos</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">occup</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">symm</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
<span class="n">mo_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_mos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">act_ele</span><span class="p">,</span> <span class="n">act_mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">find_active_space</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">asf</span><span class="o">.</span><span class="n">orbs_el_n</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">sel_mos</span><span class="p">),</span>
                                         <span class="n">sel_mos</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">occup</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">symm</span><span class="o">=</span><span class="s1">&#39;B1&#39;</span><span class="p">)</span>
<span class="n">mo_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_mos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">act_ele</span><span class="p">,</span> <span class="n">act_mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">find_active_space</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">asf</span><span class="o">.</span><span class="n">orbs_el_n</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">sel_mos</span><span class="p">),</span>
                                         <span class="n">sel_mos</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">occup</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">symm</span><span class="o">=</span><span class="s1">&#39;B2&#39;</span><span class="p">)</span>
<span class="n">mo_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_mos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">act_ele</span><span class="p">,</span> <span class="n">act_mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">find_active_space</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">asf</span><span class="o">.</span><span class="n">orbs_el_n</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">sel_mos</span><span class="p">),</span>
                                         <span class="n">sel_mos</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">occup</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">symm</span><span class="o">=</span><span class="s1">&#39;B3&#39;</span><span class="p">)</span>
<span class="n">mo_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_mos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">act_ele</span><span class="p">,</span> <span class="n">act_mos</span> <span class="o">=</span> <span class="n">ASF</span><span class="o">.</span><span class="n">find_active_space</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">asf</span><span class="o">.</span><span class="n">orbs_el_n</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">sel_mos</span><span class="p">),</span>
                                         <span class="n">sel_mos</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">occup</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">symm</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
<span class="n">mo_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_mos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

</pre></div>
</div>
<p>Now We use the lists of the orbital indexes and combine them to a larger list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">act_ele</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">orbs_el_n</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">,</span> <span class="n">act_mos</span><span class="p">)</span>

</pre></div>
</div>
<p>We can now Converge the CASSCF wave function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mo</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">sort_mo</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">act_mos</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mcscf</span><span class="o">.</span><span class="n">state_average_mix_</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="p">[</span><span class="n">solver1</span><span class="p">,</span> <span class="n">solver2</span><span class="p">,</span> <span class="n">solver3</span><span class="p">,</span> <span class="n">solver4</span><span class="p">,</span> <span class="n">solver5</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
<span class="n">ener</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>

</pre></div>
</div>
<p>We can now see the energy differences. All the quintet states are degenerate and
the sextet state:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Excitation</span> <span class="kn">from</span> <span class="nn">A</span> <span class="n">to</span> <span class="n">B2</span><span class="p">:</span>  <span class="mf">0.0</span> <span class="n">eV</span>
<span class="n">Excitation</span> <span class="kn">from</span> <span class="nn">A</span> <span class="n">to</span> <span class="n">B3</span><span class="p">:</span>  <span class="mf">0.0</span> <span class="n">eV</span>
<span class="n">Excitation</span> <span class="kn">from</span> <span class="nn">A</span> <span class="n">to</span> <span class="n">B4</span><span class="p">:</span>  <span class="mf">0.0</span> <span class="n">eV</span>
<span class="n">Excitation</span> <span class="kn">from</span> <span class="nn">spin</span> <span class="mi">3</span> <span class="n">to</span> <span class="mi">5</span><span class="p">:</span>  <span class="mf">3.1340175047152385</span> <span class="n">eV</span>
</pre></div>
</div>
</div>
<div class="section" id="utility-functions">
<h2>3. Utility functions<a class="headerlink" href="#utility-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="visualizing-the-mos-with-jmol">
<h3>3.1 Visualizing the MOs with jmol<a class="headerlink" href="#visualizing-the-mos-with-jmol" title="Permalink to this headline">¶</a></h3>
<p>In this section we will show how one can plot the ASF suggested active molecular orbitals.
We do this by taking again the <span class="math notranslate nohighlight">\(C_2\)</span>example of section 1.2.</p>
<p>After the final DMRG calculation has provided us with the final active space selection, we can
plot these MOs with ASFs <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.asf.visualize_mos()</span></code> function via the following command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">asf</span><span class="o">.</span><span class="n">visualize_mos</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">orbs</span><span class="p">,</span> <span class="n">orblist</span><span class="p">)</span>
</pre></div>
</div>
<p>By executing this command the four active molecular orbitals are plotted
to separate <em>png</em> files.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/act_mos.png"><img alt="../_images/act_mos.png" src="../_images/act_mos.png" style="width: 600px;" /></a>
</div>
<p>Furthermore, the whole set of MOs is stored in the <code class="docutils literal notranslate"><span class="pre">asf_mos.molden</span></code> file.</p>
</div>
<div class="section" id="plot-selection-thresholds-c-2">
<h3>3. Plot selection thresholds <span class="math notranslate nohighlight">\(C_2\)</span><a class="headerlink" href="#plot-selection-thresholds-c-2" title="Permalink to this headline">¶</a></h3>
<p>Visualization can be controlled by <span class="math notranslate nohighlight">\(plot\)</span>attribute of both <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.select_mos_occ()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.select_mos_ent()</span></code> functions.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/ss_entropy_0.png"><img alt="../_images/ss_entropy_0.png" src="../_images/ss_entropy_0.png" style="width: 600px;" /></a>
</div>
</div>
</div>
<div class="section" id="calculation-of-natural-orbitals">
<h2>4. Calculation of natural orbitals<a class="headerlink" href="#calculation-of-natural-orbitals" title="Permalink to this headline">¶</a></h2>
<p>Natural orbitals for any post SCF calculation can be easily calculated with ASF. functions
for this purpose are store in <code class="docutils literal notranslate"><span class="pre">/asf/nat_orbs.py</span></code>. The file containing the examples below
is located at <code class="docutils literal notranslate"><span class="pre">/examples/natorbs/c2.py</span></code>.</p>
<div class="section" id="unrestricted-natural-orbitals">
<h3>4.1 Unrestricted natural orbitals<a class="headerlink" href="#unrestricted-natural-orbitals" title="Permalink to this headline">¶</a></h3>
<p>UNOs can be calulate by calling the <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.UNOs()</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">no</span><span class="p">,</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">UNOs</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Unretricted natural orbitals</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">occ</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total occupation of unrestricted natural orbitals:&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="wrapper-function">
<h3>4.2 Wrapper function<a class="headerlink" href="#wrapper-function" title="Permalink to this headline">¶</a></h3>
<p>With the wrapper function you can simply call the nat_orbs_obj and pass it a MP2, CISD or CCSD object.
The function will calculate the symmetric (if mol object’s symmetry is set) natural orbitals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># UHF UMP2</span>
<span class="n">mp2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">UMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">no</span><span class="p">,</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">nat_orbs_obj</span><span class="p">(</span><span class="n">mp2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;MP2 natural orbitals</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">occ</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total occupation of MP2 natural orbitals:&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># CISD</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">UCISD</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">no</span><span class="p">,</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">nat_orbs_obj</span><span class="p">(</span><span class="n">mci</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;CISD natural orbitals</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">occ</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total occupation of CISD natural orbitals:&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="manual-functions">
<h3>4.3 Manual functions<a class="headerlink" href="#manual-functions" title="Permalink to this headline">¶</a></h3>
<p>In case you are calculating the natural orbitals from other methods such as CASSCF
you can use directly provide rdm1 to the right function to calculate natural orbitals.</p>
<p>For instance in case of CASSCF you can use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.nat_orbs_rdm1AO_rhf()</span></code>. Please, note
that most functions written in here require rdm1 in MO basis with the exception of <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.nat_orbs_rdm1AO_rhf()</span></code>.
If you require a to project your rdm1 from MO to AO basis you can look up some useful function for that
in utility section.</p>
<p>In script below we calculate the active space natural orbitals using both modes available in <code class="xref py py-meth docutils literal notranslate"><span class="pre">asf.nat_orbs_rdm1AO_rhf()</span></code>
and compare the overlap of both set of orbitals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># CASSCF</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">intor_symmetric</span><span class="p">(</span><span class="s1">&#39;int1e_ovlp&#39;</span><span class="p">)</span>
<span class="n">no</span><span class="p">,</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">nat_orbs_rdm1AO_rhf</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(),</span> <span class="n">mc</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>

<span class="n">no_active_1</span> <span class="o">=</span> <span class="n">no</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;CASCF(6,6) natural orbitals</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">occ</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total occupation of CASSCF(6,6) natural orbitals:&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ</span><span class="p">))</span>

<span class="c1"># CASSCF</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">intor_symmetric</span><span class="p">(</span><span class="s1">&#39;int1e_ovlp&#39;</span><span class="p">)</span>
<span class="n">no</span><span class="p">,</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">asf</span><span class="o">.</span><span class="n">nat_orbs_rdm1AO_rhf</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(),</span> <span class="n">mc</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;CASCF(6,6) natural orbitals</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">occ</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Total occupation of CASSCF(6,6) natural orbitals:&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ</span><span class="p">))</span>

<span class="c1"># Only active natural orbitals are meaningful</span>
<span class="n">no_active_2</span> <span class="o">=</span> <span class="n">no</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>

<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">no_active_1</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">no_active_2</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Natural orbitals calculated from both modes match&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;A mistake found&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../modules.html" class="btn btn-neutral float-left" title="Code documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Reza Shirazi, Thilo Mast

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>